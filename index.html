<script>
  const params = new URLSearchParams(window.location.search);
  const videoUrl = params.get("video");
  const shouldAutoplay = params.get("autoplay") === "1";

  const container = document.getElementById("playerContainer");

  if (!videoUrl) {
    container.innerHTML = '<div class="error">Missing ?video= parameter</div>';
  } else {
    const videoEl = document.createElement("video");
    videoEl.className = "video-js vjs-big-play-centered";
    videoEl.setAttribute("controls", true);
    videoEl.setAttribute("playsinline", true);
    videoEl.setAttribute("referrerpolicy", "no-referrer");
    videoEl.style.width = "100%";
    videoEl.style.height = "500px";

    const source = document.createElement("source");
    source.src = videoUrl;
    source.type = "video/mp4";

    videoEl.appendChild(source);
    container.appendChild(videoEl);

    const player = videojs(videoEl, {
      controls: true,
      preload: "auto",
      autoplay: false,
      muted: false,
      fluid: false,
    });

    player.ready(() => {
      if (shouldAutoplay) {
        const htmlVideo = player.el().querySelector("video");
        htmlVideo?.play().catch(() => {});
      }
    });

    // Listen for pause messages from parent
    window.addEventListener("message", (event) => {
      if (event.data?.type === "pause") {
        player.pause();
      }
    });
  }
</script>
